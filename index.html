<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Waitlist</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #0000FF;
      color: #FFFFFF;
      font-family: 'Akkurat', 'Swish School Sans', sans-serif;
      overflow-x: hidden;
    }
    #header {
      position: relative;
      width: 100%;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    #header img {
      max-width: 80vw;
      height: auto;
      transition: transform 0.3s ease;
    }
    #header.shrink img {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%) scale(0.2);
      max-width: none;
    }
    #welcome {
      display: none;
      text-align: center;
      font-size: 2rem;
      margin: 2rem 0;
    }
    .dos-block {
      display: inline-block;
      width: 1rem;
      height: 1rem;
      background: #FFFFFF;
      vertical-align: middle;
      margin-right: 0.5rem;
    }
    #product-section {
      display: none;
      text-align: center;
      margin: 2rem 0;
    }
    #product-image-container {
      width: 80vw;
      max-width: 600px;
      overflow: hidden;
      height: 0;
      margin: 0 auto;
    }
    #product-image {
      width: 100%;
      height: auto;
      display: block;
    }
    #product-details {
      display: none;
      line-height: 1.5;
      margin: 1rem auto;
      text-align: center;
    }
    #waitlist-btn {
      display: none;
      padding: 1rem 2rem;
      border: 2px solid #FFFFFF;
      background: transparent;
      color: #FFFFFF;
      cursor: pointer;
      position: relative;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <div id="header">
    <img id="header-image" src="https://i.ibb.co/DP0MHnjM/IMG-6365.jpg" alt="Header">
  </div>
  <div id="welcome">
    <span class="dos-block"></span><span id="welcome-text"></span>
  </div>
  <div id="product-section">
    <div id="product-image-container">
      <img id="product-image" src="" alt="Product">
    </div>
    <div id="product-details"></div>
  </div>
  <button id="waitlist-btn">join the waitlist</button>

  <script>
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT6aU1_jB0juldfdNBs-KX3XLLqOuAoZDNpg_znvr_x1ToUAariHKo2Gz-REVye58V_nenvXETUOTZk/pub?output=csv';
    let csvData = {};

    fetch(csvUrl)
      .then(r => r.text())
      .then(text => {
        const rows = text.trim().split('\n').map(line => line.split(','));
        csvData.product    = rows[0][1] || '';
        csvData.productImg = rows[1][1] || '';
        csvData.materials  = rows[2][1] || '';
        csvData.price      = rows[3][1] || '';
        csvData.wait       = rows[4][1] || '';
        initScroll();
      })
      .catch(console.error);

    function initScroll() {
      const header = document.getElementById('header');
      const welcome = document.getElementById('welcome');
      const welcomeText = document.getElementById('welcome-text');
      let typed = false;
      const msg = 'welcome to waitlist.';

      window.addEventListener('scroll', () => {
        if (window.scrollY > header.clientHeight * 0.5 && !typed) {
          typed = true;
          header.classList.add('shrink');
          showWelcome();
        }
      });

      function showWelcome() {
        welcome.style.display = 'block';
        let i = 0;
        function typeChar() {
          if (i < msg.length) {
            welcomeText.textContent += msg.charAt(i++);
            setTimeout(typeChar, 100);
          } else {
            showProductSection();
          }
        }
        typeChar();
      }
    }

    function showProductSection() {
      const sec = document.getElementById('product-section');
      const imgCont = document.getElementById('product-image-container');
      const prodImg = document.getElementById('product-image');
      sec.style.display = 'block';
      prodImg.src = csvData.productImg;

      prodImg.onload = () => {
        const fullH = prodImg.naturalHeight * (imgCont.clientWidth / prodImg.naturalWidth);
        let h = 0, step = fullH / 50;
        const timer = setInterval(() => {
          h += step;
          if (h >= fullH) {
            clearInterval(timer);
            imgCont.style.height = fullH + 'px';
            showProductDetails();
          } else {
            imgCont.style.height = h + 'px';
          }
        }, 50);
      };
    }

    function showProductDetails() {
      const det = document.getElementById('product-details');
      det.innerHTML = 
        'Product: '   + csvData.product   + '<br>' +
        'Materials: ' + csvData.materials + '<br>' +
        'Price: '     + csvData.price     + '<br>' +
        'Wait: '      + csvData.wait;
      det.style.display = 'block';
      showWaitlistButton();
    }

    function showWaitlistButton() {
      const btn = document.getElementById('waitlist-btn');
      btn.style.display = 'block';
      let clicks = 0;

      btn.addEventListener('click', () => {
        clicks++;
        if (clicks < 3) {
          const x = Math.random() * (window.innerWidth - btn.offsetWidth);
          const y = Math.random() * (window.innerHeight - btn.offsetHeight);
          btn.style.position = 'absolute';
          btn.style.left = x + 'px';
          btn.style.top = y + 'px';
        } else {
          document.body.innerHTML = '';
          setTimeout(() => lockOut(), 2000);
        }
      });
    }

    function lockOut() {
      const d = document.createElement('div');
      Object.assign(d.style, {
        position: 'fixed',
        top: '50%',
        left: '50%',
        transform: 'translate(-50%, -50%)',
        fontSize: '2rem',
        textAlign: 'center'
      });
      document.body.appendChild(d);

      let sec = 900;
      d.textContent = `You are locked out of waitlist for ${sec} seconds`;
      const countdown = setInterval(() => {
        sec--;
        if (sec >= 0) {
          d.textContent = `You are locked out of waitlist for ${sec} seconds`;
        } else {
          clearInterval(countdown);
        }
      }, 1000);
    }
  </script>
</body>
</html>
